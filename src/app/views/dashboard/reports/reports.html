<ui-view></ui-view>

<header class="section">
	<div class="container">

		<h1 translate>Reports</h1>
		<br>

		<div class="row">
			<div class="col-sm-5 col-md-6">
				<nav class="platform-list inline pull-left">
					<ul>
						<li>
							<a
								ui-sref="dashboard.reports.view( { period: 'all' } )"
								ui-sref-active="active"
								translate
								>
								All-Time
							</a>
							<a
								ui-sref="dashboard.reports.view( { period: 'monthly' } )"
								ui-sref-active="active"
								translate
								>
								Monthly
							</a>
						</li>
					</ul>
				</nav>

				<div class="pull-left">
					<strong>Game</strong>
					<br>
					<em>Tea Time With Luap Sere...</em>
				</div>
			</div>
			<div class="col-md-6 text-right">

				<div class="reports-month-selector" ng-if="reportsCtrl.period == 'monthly'">
					<a class="btn btn-outline btn-sparse"
						ui-sref="dashboard.reports.view( { period: 'monthly', year: reportsCtrl.prevYear, month: reportsCtrl.prevMonth } )"
						>
						<span class="jolticon jolticon-chevron-left"></span>
					</a>

					<strong>
						{{ reportsCtrl.startTime | date:'MMMM yyyy' }}
					</strong>

					<a class="btn btn-outline btn-sparse"
						ui-sref="dashboard.reports.view( { period: 'monthly', year: reportsCtrl.nextYear, month: reportsCtrl.nextMonth } )"
						>
						<span class="jolticon jolticon-chevron-right"></span>
					</a>
				</div>

			</div>
		</div>

	</div>
</header>

<div oc-lazy-load="{ files: [ '/app/modules/graphs.js' ] }">

	<div gj-expand-when="reportsCtrl.period == 'monthly'">
		<gj-graph
			ng-if="reportsCtrl[ reportsCtrl.eventType ].graph"
			dataset="reportsCtrl[ reportsCtrl.eventType ].graph"
			>
		</gj-graph>
	</div>

	<section class="section section-thin">
		<div class="container">

			<div class="row">
				<div class="col-sm-4 col-md-3" ng-repeat="stat in reportsCtrl.stats track by stat.label">

					<a class="stat-graph-overlay"
						ui-sref="dashboard.reports.view( { eventType: stat.eventType } )"
						ui-sref-active="active"
						>

						<gj-graph
							ng-if="reportsCtrl.period == 'monthly' && reportsCtrl[ stat.eventType ]"
							dataset="reportsCtrl[ stat.eventType ].graph"
							background-variant
							>
						</gj-graph>

						<div class="stat-big">
							<div class="stat-big-label">
								{{ stat.label }}
							</div>
							<div class="stat-big-digit" ng-switch="stat.type">
								<span ng-switch-when="number">
									{{ reportsCtrl.getStatValue( stat ) | number }}
								</span>

								<span ng-switch-when="currency">
									{{ reportsCtrl.getStatValue( stat ) / 100 | currency }}
								</span>
							</div>
						</div>
					</a>

				</div>
			</div>

		</div>
	</section>

	<div ng-if="reportsCtrl.breakdownReports.length">

		<hr>

		<section class="section">
			<div class="container">

				<div class="row">
					<div class="col-md-3" ng-if="Screen.isDesktop">

						<nav class="platform-list" gj-scroll-affix>
							<ul>
								<li ng-repeat="report in reportsCtrl.breakdownReports | orderBy:'index'">
									<a ng-href="#report-{{ report.index }}" du-smooth-scroll du-scrollspy>{{ report.title }}</a>
								</li>
							</ul>
						</nav>

					</div>
					<div class="col-md-9">

						<div ng-repeat="report in reportsCtrl.breakdownReports | orderBy:'index' track by report.index" id="report-{{ report.index }}">

							<h2 ng-class="{ 'section-header': $first }">{{ report.title }}</h2>

							<div ng-if="report.type == 'top'">
								<div class="row">
									<div class="col-sm-8">

										<table class="table table-striped table-condensed">
											<thead>
												<tr>
													<th style="width: 20px"></th>
													<th>
														{{ report.fieldLabel }}
													</th>
													<th class="text-right">
														{{ reportsCtrl.stats[ reportsCtrl.eventType ].label }}
													</th>
													<th style="width: 150px"></th>
												</tr>
											</thead>
											<tbody>
												<tr ng-repeat="( key, val ) in report.data track by key">
													<td>
														{{ $index + 1 | number }}.
													</td>
													<th>
														{{ key }}
													</th>
													<td class="text-right">
														{{ val | number }}
													</td>
													<td>
														<div class="report-percentage" ng-style="{ width: val / report.total * 70 + 'px' }"></div>
														<small>{{ val / report.total * 100 | number:2 }}%</small>
													</td>
												</tr>
											</tbody>
										</table>

									</div>
									<div class="col-sm-4" ng-if="!Screen.isXs">

										<gj-graph
											type="doughnut"
											dataset="report.graph"
											>
										</gj-graph>

									</div>
								</div>
							</div>

						</div>

					</div>
				</div>

			</div>
		</section>

	</div>
</div>
