<div class="chat-window-wrap">

	<!--
		We sadly need the chat close thing twice.
		It takes up the empty background space so you can click that to close chat.
	-->
	<div class="chat-window-back-close" @click="closeChat"></div>
	<div class="chat-window anim-fade-in-up">
		<div class="chat-window-back-close" @click="closeChat"></div>

		<!-- Room Users -->
		<transition>
			<div class="fill-darkest chat-window-users scrollable overlay-scrollbar anim-fade-enter-enlarge anim-fade-leave-shrink"
				v-if="!room.isPmRoom && isShowingUsers"
				>

				<div v-if="Screen.isXs">
					<br>
					<div class="nav-controls">
						<button class="btn btn-outline btn-block" @click="toggleUsers">
							<app-jolticon icon="chevron-left" />
							<translate>Back to Chat</translate>
						</button>
					</div>
				</div>

				<div class="nav-heading first">
					<translate>Room Users</translate>
					<span class="badge" :class="{ 'badge-active': users && users.onlineCount > 0 }">
						{{ users ? users.onlineCount : 0 | number }}
					</span>
				</div>

				<app-chat-user-list
					v-if="users"
					:room="room"
					:users="users.collection"
					:show-mod-tools="room.isMod"
					>
				</app-chat-user-list>

			</div>
		</transition>

		<div class="chat-window-main">

			<!-- Window Header -->
			<div class="chat-window-header-wrap">
				<div class="chat-window-header fill-darkest">

					<div class="chat-window-header-controls">

						<button class="btn btn-sparse anim-fade-in"
							@click="showEditRoomModal"
							v-if="room.isMod"
							:title="$gettext( 'Edit Room Details' )"
							>
							<app-jolticon icon="edit" />
						</button>

						<button class="btn btn-sparse"
							v-if="!chat.singleRoomMode"
							@click="minimize"
							:title="$gettext( 'Minimize Room' )"
							>
							<app-jolticon icon="minus" />
						</button>

						<button class="btn btn-sparse"
							@click="close"
							:title="$gettext( 'Close Room' )"
							>
							<app-jolticon icon="remove" />
						</button>

					</div>

					<!--
						Animation scope.
					-->
					<div
						class="chat-window-header-content"
						v-for="room of [ room ]"
						:key="room.id"
						>

						<a class="chat-window-header-avatar avatar anim-fade-in-enlarge no-animate-xs"
							v-if="room.isPmRoom"
							:href="room.user.url"
							>
							<img :src="room.user.imgAvatar" alt="">
						</a>

						<h3 v-if="!room.isPmRoom" class="anim-fade-in-right no-animate-xs">
							{{ room.title }}
						</h3>

						<h3 v-if="room.isPmRoom" class="anim-fade-in-right no-animate-xs"
							:title="`${room.user.displayName} (@${room.user.username})`"
							>
							<a class="link-unstyled"
								:href="room.user.url"
								>
								{{ room.user.displayName }}
							</a>
							<br>
							<small>@{{ room.user.username }}</small>
						</h3>

						<div v-if="!room.isPmRoom" style="clear: both;">
							<app-fade-collapse
								class="fade-collapse-sm"
								v-if="!Screen.isXs"
								:collapse-height="50"
								@required="room._description_collapsed = true"
								style="display: block; max-height: 50px; overflow: hidden;"
								>
								<div class="chat-window-header-room-description chat-compiled-room-description">
									<div class="anim-fade-in no-animate-xs" v-html="room.description_compiled"></div>
								</div>
							</app-fade-collapse>

							<div>
								<button class="btn btn-sm toggle-users"
									:class="isShowingUsers ? 'btn-success-outline' : 'btn-outline'"
									@click="toggleUsers"
									>
									<translate v-if="!isShowingUsers">Show Users</translate>
									<translate v-else>Hide Users</translate>
									({{ users.onlineCount | number }})
								</button>

								<button class="btn btn-sm btn-outline"
									v-if="room._description_collapsed || Screen.isXs"
									@click="showRoomDetails"
									>
									<translate>View Room Description</translate>
								</button>
							</div>
						</div>
					</div>

				</div>
			</div>

			<!--
				The v-for is a hack to make sure we destroy/recreate each time
				the room changes.
			-->
			<app-chat-window-output
				class="chat-window-output"
				v-for="room of [ room ]"
				:key="room.id"
				:room="room"
				:messages="messages"
				/>

			<div class="chat-window-send-container" v-if="chat.currentUser">
				<app-chat-window-send />
			</div>

		</div>

	</div>
</div>
