<app-form name="packageForm">
	<app-loading-fade :is-loading="isProcessing">

		<app-form-group
			name="title"
			:label="$gettext( `dash.games.packages.form.title_label` )"
			>
			<p class="help-block">
				<translate :escape-html="false"
					>dash.games.packages.form.title_help_html
				</translate>
			</p>

			<app-form-control
				:rules="{
					max: 150,
					availability: `/web/dash/developer/games/packages/check-field-availability/${ game.id }/title`
				}"
				/>

			<app-form-control-errors />
		</app-form-group>

		<app-form-group
			name="description"
			:label="$gettext( `dash.games.packages.form.description_label` )"
			:optional="true"
			>
			<p class="help-block">
				<translate :escape-html="false">
					dash.games.packages.form.description_help_html
				</translate>
			</p>

			<div v-if="!showDescriptionInput">
				<button class="btn btn-outline btn-sm" @click="showDescriptionInput = true">
					<app-jolticon icon="add" />
					<translate>dash.games.packages.form.description_change_button</translate>
				</button>
			</div>
			<div v-else>
				<app-form-control-textarea rows="2" :rules="{ max: 750 }" />
				<app-form-control-errors />
			</div>
		</app-form-group>

		<app-form-group
			name="visibility"
			:label="$gettext( `Visibility` )"
			>
			<div class="radio">
				<label>
					<app-form-control-radio :value="GamePackage.VISIBILITY_PUBLIC" />
					<translate>Public</translate> &mdash;
					<span class="help-inline">
						<translate>Anyone can access this package.</translate>
					</span>
				</label>
			</div>

			<div class="radio">
				<label>
					<app-form-control-radio :value="GamePackage.VISIBILITY_PRIVATE" />
					<translate>Private</translate> &mdash;
					<span class="help-inline">
						<translate :escape-html="false">Only you can access this package, as well as any keys you assign. You can assign keys in your <b>Keys/Access</b> page.</translate>
					</span>
				</label>
			</div>

			<div class="alert alert-info">
				<translate>Note that regardless of this setting, your package will only be visible on your game's page if it has published releases in it.</translate>
			</div>
		</app-form-group>

		<app-form-group
			name="pricing_type"
			:label="$gettext( `Pricing Type` )"
			>

			<div class="alert alert-warning" v-if="isFangame">
				<translate>Accepting payments for fangames is illegal and against our terms. If you sell fangames, we will remove your account and block you from the Marketplace.</translate>
			</div>
			<div v-else>
				<p class="help-block" v-if="!isUserVerified">
					<app-jolticon icon="notice" />
					<translate>
						You must set up your financial information before you can start accepting money.
					</translate>
					<router-link :to="{ name: 'dash.account.financials' }">
						<translate>Go to financial set up.</translate>
					</router-link>
				</p>

				<div class="alert alert-warning" v-if="isUserVerified && package && package.has_browser_builds">
					<translate>Packages with browser builds cannot be sold at this time.</translate>
				</div>
			</div>

			<div class="radio">
				<label>
					<app-form-control-radio value="free" />
					<translate>Free</translate> &mdash;
					<span class="help-inline">
						<translate>Completely free with no option to pay at all.</translate>
					</span>
				</label>
			</div>

			<div class="radio" :class="{ disabled: !isUserVerified || isFangame }">
				<label>
					<app-form-control-radio value="pwyw" :disabled="!isUserVerified || isFangame" />
					<translate>Pay What You Want</translate> &mdash;
					<span class="help-inline">
						<translate>They will be able to pay $0 or more. They set the price.</translate>
					</span>
				</label>
			</div>

			<div class="radio"
				:class="{
					disabled: !isUserVerified || (package && package.has_browser_builds) || isFangame,
				}"
				>
				<label>
					<app-form-control-radio
						value="paid"
						:disabled="!isUserVerified || (package && package.has_browser_builds) || isFangame"
						/>
					<translate>Paid</translate> &mdash;
					<span class="help-inline">
						<translate>Charge a specific price with the ability for them to pay more.</translate>
					</span>
				</label>
			</div>
		</app-form-group>

		<app-form-group
			name="price"
			:label="$gettext( `Suggested Price` )"
			v-if="formModel.pricing_type === 'pwyw'"
			:optional="true"
			>
			<div class="row">
				<div class="col-sm-3">
					<app-form-group
						name="has_suggested_price"
						:hide-label="true"
						>
						<app-form-control-toggle />
					</app-form-group>
					<br class="visible-xs">
				</div>
				<div class="col-sm-9">
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<!--TODO-->
						<app-form-control
							type="number"
							step="0.1"
							:rules="{
								min_value: minPrice / 100,
							}"
							:disabled="!formModel.has_suggested_price"
							/>
							<!--gj-form-currency-input-->
					</div>
					<app-form-control-errors />
				</div>
			</div>
		</app-form-group>

		<app-form-group
			name="price"
			:label="$gettext( `Price` )"
			v-if="formModel.pricing_type === 'paid'"
			>
			<div class="input-group">
				<span class="input-group-addon">$</span>
				<!--TODO-->
				<app-form-control
					type="number"
					step="0.1"
					:rules="{
						min_value: minPrice / 100,
					}"
					/>
					<!--gj-form-currency-input-->
			</div>
			<app-form-control-errors />
		</app-form-group>

		<!--TODO-->
		<!--<div v-if="formModel.pricing_type === 'paid'">
			<div class="form-group">

				<label class="control-label">
					<translate>Run a Sale</translate>
				</label>

				<div v-if="promotionalPricing">
					<div class="alert alert-info" v-if="promotionalPricing.start > now" translate>A sale is currently scheduled.</div>
					<div class="alert alert-success" v-if="promotionalPricing.start <= now" translate>Your sale is currently running.</div>

					<div class="table-responsive" v-if="promotionalPricing">
						<table class="table sans-margin-bottom">
							<colgroup>
								<col class="col-xs-4 col-sm-4 col-md-3">
							</colgroup>
							<tr>
								<th translate>Timezone</th>
								<td>
									{{ promotionalPricing.timezone }}
									<div class="text-muted small" translate>
										All times are based off this timezone.
									</div>
								</td>
							</tr>
							<tr>
								<th translate>Start</th>
								<td>
									{{ saleStartLocal | amDateFormat:'lll' }}
									<div class="text-muted small" am-time-ago="promotionalPricing.start"></div>
								</td>
							</tr>
							<tr>
								<th translate>End</th>
								<td>
									{{ saleEndLocal | amDateFormat:'lll' }}
									<div class="text-muted small" am-time-ago="promotionalPricing.end"></div>
								</td>
							</tr>
							<tr>
								<th translate>Price</th>
								<td>
									{{ promotionalPricing.amount | gjCurrency }}
									<div class="text-muted small">
										{{ ((originalPricing.amount - promotionalPricing.amount) / originalPricing.amount * 100).toFixed( 0 ) }}% off
									</div>
								</td>
							</tr>
						</table>
					</div>

					<div>
						<a class="btn btn-outline btn-sm" @click="isShowingSaleForm = true" v-if="!isShowingSaleForm">
							<app-jolticon icon="edit" />
							<span translate>Edit Sale</span>
						</a>
						<a class="btn btn-danger-outline btn-sm" @click="cancelSale()">
							<app-jolticon icon="remove" />
							<span translate>Cancel Sale</span>
						</a>
					</div>
				</div>

				<div v-if="!promotionalPricing">
					<a class="btn btn-outline btn-sm" @click="isShowingSaleForm = true" v-if="!isShowingSaleForm">
						<app-jolticon icon="add" />
						<span translate>Setup Sale</span>
					</a>
				</div>
			</div>

			<div v-if="isShowingSaleForm">
				<app-form-group name="sale_timezone" :label="$gettext( `Timezone` )">

					<p class="help-block" translate>
						All time selection below will use this timezone.
					</p>

					<p class="help-block">
						<strong translate>Should auto-detect, but if it doesn't, choose your closest city.</strong>
					</p>

					<select form-control ng-options="timezone.i as timezone.label group by timezone.r for timezone in timezones"></select>

					<app-form-control-errors />

				</app-form-group>

				<div class="form-group">
					<label class="control-label" translate>
						Start
					</label>-->

					<!--
						Can only set this when first setting up a sale.
					-->
					<!--<app-form-group name="sale_start_now" hide-label="true" v-if="!promotionalPricing">
						<div class="checkbox">
							<label>
								<input form-control="checkbox">
								<span translate>Start immediately?</span>
							</label>
						</div>
					</app-form-group>

					<app-form-group name="sale_start" hide-label="true" v-if="!formModel.sale_start_now || promotionalPricing">
						<gj-datetime-picker
							name="sale_start"
							date-model="formModel.sale_start"
							date-server-errors="serverErrors"
							timezone="formModel.sale_timezone"
							min-date="now"
							>
						</gj-datetime-picker>
						<app-form-control-errors label="start time" />
					</app-form-group>
				</div>

				<app-form-group name="sale_end" :label="$gettext( `End` )">
					<gj-datetime-picker
						name="sale_end"
						date-model="formModel.sale_end"
						date-server-errors="serverErrors"
						timezone="formModel.sale_timezone"
						min-date="formModel.sale_start"
						>
					</gj-datetime-picker>
					<app-form-control-errors label="end time" />
				</app-form-group>

				<app-form-group name="sale_price" :label="$gettext( `Sale Price` )">
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input form-control="number"
							gj-form-currency-input
							step="0.1"
							ng-min="minPrice / 100"
							ng-max="formModel.price - 0.01"
							>
					</div>

					<p class="help-block" v-if="formModel.price && formModel.sale_price">
						{{ ((formModel.price - formModel.sale_price) / formModel.price * 100).toFixed( 0 ) }}% off
					</p>

					<app-form-control-errors />
				</app-form-group>
			</div>
		</div>-->

		<app-form-group
			name="primary"
			:label="$gettext( `Primary Package` )"
			:optional="!startedPrimary && hasPrimarySellable"
			>
			<p class="help-block">
				<translate>We use the primary package to determine the price to show on game listings. You can only have one primary package for your game.</translate>
			</p>
			<div class="checkbox">
				<label>
					<app-form-control-checkbox
						:disabled="startedPrimary || !hasPrimarySellable"
						/>

					<span v-if="!hasPrimarySellable">
						<strong>
							<translate>Since you don't have any packages yet, we'll mark this as your primary one.</translate>
						</strong>
					</span>
					<span v-else>
						<span v-if="!startedPrimary">
							<translate>Make this package the primary package</translate>
						</span>
						<strong v-else>
							<translate>This is currently the primary package</translate>
						</strong>
					</span>
				</label>
			</div>
		</app-form-group>

		<app-form-button
			v-if="method === 'add' || changed"
			:icon="method"
			>
			<span v-if="method === 'add'">
				<translate>dash.games.packages.form.add_package_button</translate>
			</span>
			<span v-else-if="method === 'edit'">
				<translate>dash.games.packages.form.save_package_button</translate>
			</span>
		</app-form-button>

	</app-loading-fade>
</app-form>
